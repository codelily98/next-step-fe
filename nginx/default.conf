server {
    listen 80; # 부하 분산기로부터 HTTP 요청을 받습니다.
    server_name portfolio-nextstep.info; # ⭐ 이 부분을 변경합니다.

    # ⭐ SSL 설정(listen 443 ssl, ssl_certificate 등)은 추가하지 않습니다.
    #    부하 분산기가 HTTPS Termination을 담당하기 때문입니다.

    # React FE 정적 파일 서빙
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri /index.html;
    }

    # Spring Boot 백엔드 API 리버스 프록시
    location /api/ {
        # ⭐ 백엔드 VM의 내부 IP 주소와 포트를 지정합니다.
        #    VM 인스턴스 목록에서 next-step-backend의 내부 IP (10.178.0.7)를 사용합니다.
        proxy_pass http://10.178.0.7:8080/; 
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $http_x_forwarded_proto; # 부하 분산기에서 전달하는 원래 프로토콜 헤더
        # 또는 단순히 proxy_set_header X-Forwarded-Proto https; 를 사용해도 됩니다.
    }

    # (선택 사항) 웹소켓 사용 시 (백엔드에서 웹소켓 사용 시)
    # location /ws/ {
    #    proxy_pass http://10.178.0.7:8080/ws/;
    #    proxy_http_version 1.1;
    #    proxy_set_header Upgrade $http_upgrade;
    #    proxy_set_header Connection "upgrade";
    #    proxy_set_header Host $host;
    #    proxy_set_header X-Real-IP $remote_addr;
    #    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    # }
}